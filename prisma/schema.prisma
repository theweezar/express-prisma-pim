generator client {
  provider = "prisma-client"
  output   = "./generated"
}

datasource db {
  provider = "sqlite"
}

enum SystemEntityType {
  NA
  PRODUCT
  CATALOG
  CATEGORY
}

enum AttributeValueType {
  NA
  STRING
  NUMBER
  BOOLEAN
  ARRAY
  DATE
  DATETIME
  // SET_OF_STRINGS
}

model SystemEntity {
  ID               Int              @id @default(autoincrement())
  UUID             String           @unique @default(uuid())
  systemEntityType SystemEntityType
  attributeValues  AttributeValue[]
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  version          Int              @default(1)
}

model AttributeDefinition {
  ID                        Int                        @id @default(autoincrement())
  key                       String
  label                     String
  systemEntityType          SystemEntityType
  attributeValueType        AttributeValueType
  primary                   Boolean                    @default(false)
  required                  Boolean                    @default(false)
  unique                    Boolean                    @default(false)
  minlength                 Int?
  maxlength                 Int?
  attributeValues           AttributeValue[]
  attributeGroupAssignments AttributeGroupAssignment[]
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  version                   Int                        @default(1)

  @@unique([systemEntityType, key])
}

model AttributeGroupDefinition {
  ID                        Int                        @id @default(autoincrement())
  key                       String
  label                     String
  systemEntityType          SystemEntityType
  attributeGroupAssignments AttributeGroupAssignment[]
  ordinal                   Int
  createdAt                 DateTime                   @default(now())
  updatedAt                 DateTime                   @updatedAt
  version                   Int                        @default(1)

  @@unique([systemEntityType, key])
}

model AttributeGroupAssignment {
  ID                         Int                       @id @default(autoincrement())
  attributeDefinition        AttributeDefinition       @relation(fields: [attributeDefinitionID], references: [ID])
  attributeDefinitionID      Int
  attributeGroupDefinition   AttributeGroupDefinition? @relation(fields: [attributeGroupDefinitionID], references: [ID])
  attributeGroupDefinitionID Int
  ordinal                    Int

  @@unique([attributeGroupDefinitionID, attributeDefinitionID])
}

model AttributeValue {
  ID                  Int                 @id @default(autoincrement())
  UUID                String              @unique @default(uuid())
  value               String?
  entityID            Int
  entity              SystemEntity        @relation(fields: [entityID], references: [ID])
  attributeID         Int
  attributeDefinition AttributeDefinition @relation(fields: [attributeID], references: [ID])

  @@unique([entityID, attributeID])
}
